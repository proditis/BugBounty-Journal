#
# Perform basic sub domain and other assets on a given domain
# Check if exclude-patterns exists and dont include such results into the list
#
kali_enum_subs:
  stage: information_gathering
  image: kalilinux/kali-rolling:latest
  before_script:
    - echo "Before script section"
    - echo "Running on $(hostname)"
    - echo "uname $(uname -a)"
    - apt-get update
    - apt-get install -yqq golang-go amass subfinder assetfinder jq
    - if [ ! -f exclude-patterns ]; then touch exclude-patterns; fi
  script:
    - |
      {
        subfinder -silent -d ${domain}
        assetfinder -subs-only ${domain}
        amass enum -passive -d ${domain}
      } | sort -u |grep -v -f exclude-patterns| tee -a ${DOMAIN}-subdomains.list
  artifacts:
    name: "$DOMAIN:$CI_JOB_NAME:subdomains"
    paths:
      - ${DOMAIN}-subdomains.list
  rules:
    - if: $CI_PIPELINE_SOURCE == "web"
      when: manual
